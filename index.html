<!DOCTYPE html>
<html lang="kn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Challenge - GHPS Dasaravadi</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root { --primary: #1a2a6c; --gold: #c5a059; --accent: #b21f1f; }
        
        /* Mobile Best View Optimization */
        body { 
            font-family: 'Montserrat', sans-serif; 
            background: #f0f2f5; 
            margin: 0; 
            padding: 10px; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        
        .container { max-width: 800px; margin: auto; }
        .hidden { display: none !important; }
        
        .header { 
            background: linear-gradient(135deg, var(--primary), var(--accent)); 
            color: white; 
            text-align: center; 
            padding: 25px 15px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
        }
        
        .rainbow-school-name { 
            font-family: 'Cinzel', serif; 
            font-size: 20px; 
            font-weight: bold; 
            margin-bottom: 8px; 
            display: block; 
            background: linear-gradient(to right, #ff2400, #e81d1d, #e8b71d, #1de840, #1ddde8, #2b1de8, #dd1de8, #ff2400); 
            background-size: 200% auto; 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            animation: rainbow_move 3s linear infinite; 
            cursor: pointer; 
            user-select: none;
        }

        @keyframes rainbow_move { to { background-position: 200% center; } }
        
        #statusBanner { padding: 10px; border-radius: 8px; margin-top: 12px; font-weight: bold; font-size: 13px; text-align: center; }
        .status-upcoming { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .status-live { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; animation: pulse 2s infinite; }
        .status-closed { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); margin-top: 15px; border-top: 5px solid var(--gold); }
        
        
        /* QUIZ ACCESS SCREEN */
.access-bg{
  position:fixed;
  inset:0;
  background:linear-gradient(to right, #ff2400, #e81d1d, #e8b71d, #1de840, #1ddde8, #2b1de8, #dd1de8, #ff2400);
  background-size:400% 400%;
  animation:bgMove 5s ease infinite;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

@keyframes bgMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.access-card{
  background:#ffffff;;
  padding:30px 25px;
  width:380px;
  border-radius:20px;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,0.3);
  animation:pop 4s ease;
}

@keyframes pop{
  from{transform:scale(0.8);opacity:0}
  to{transform:scale(1);opacity:1}
}

.lock-circle{
  width:70px;
  height:70px;
  margin:auto;
  background:linear-gradient(135deg,#c5a059,#f7d774);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:32px;
  margin-bottom:10px;
}

.school-name{
  color:#0000CD;
  font-family:'Cinzel',serif;
  font-size:16px;
  margin:5px 0;	
}

.quiz-title{
  color:#b21f1f;
  margin-bottom:15px;
}

.access-card input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:2px solid #ddd;
  font-size:16px;
  text-align:center;
}

.access-btn{
  margin-top:15px;
  width:100%;
  padding:14px;
  font-size:16px;
  font-weight:bold;
  color:white;
  background:linear-gradient(135deg,#1a2a6c,#b21f1f);
  border:none;
  border-radius:14px;
  cursor:pointer;
  transition:0.3s;
}

.access-btn:hover{
  transform:scale(1.05);
  box-shadow:0 0 15px rgba(178,31,31,0.6);
}

.error-msg{
  color:red;
  margin-top:10px;
  font-weight:bold;
}

        /* Large touch targets for inputs */
        input, select { 
            width: 100%; 
            padding: 14px; 
            margin: 8px 0 15px 0; 
            border: 2px solid #eee; 
            border-radius: 10px; 
            box-sizing: border-box; 
            font-size: 16px; /* Prevents auto-zoom on mobile */
            outline: none; 
        }
        
        #sName, #pName { text-transform: uppercase; }

        button { padding: 16px; font-size: 16px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 10px; width: 100%; }
        .btn-main { background: var(--primary); color: white; }
        .btn-main:disabled { background: #ccc; cursor: not-allowed; }
        
        /* Question Layout for Mobile */
        .question-box { margin-bottom: 25px; padding: 18px; border-radius: 15px; background: #fff; border: 1px solid #eaeaea; }
        .question-text { font-size: 18px; display: block; margin-bottom: 15px; color: #333; }
        
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        
        .option-card { 
            background: #f8f9fa; 
            border: 2px solid #eaeaea; 
            padding: 16px; 
            border-radius: 12px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            font-size: 16px;
            font-weight: 500;
        }
        
        .option-card input[type="radio"] { 
            width: 22px; 
            height: 22px; 
            margin-right: 12px; 
            accent-color: var(--primary);
        }

        #timer-sticky { 
            position: sticky; 
            top: 0; 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(5px);
            padding: 12px; 
            text-align: center; 
            font-size: 20px; 
            font-weight: 800; 
            color: #b21f1f; 
            z-index: 100; 
            border-bottom: 3px solid var(--gold); 
        }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
        th, td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; }

        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
            .rainbow-school-name { font-size: 24px; }
            .header { padding: 35px 20px; }
        }
    </style>
</head>
<body>

<!-- ATTRACTIVE QUIZ ACCESS SCREEN -->
<div id="passwordScreen" class="access-bg">
  <div class="access-card">
    <div class="lock-circle">üîí</div>

    <h2 class="school-name">‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü, ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø</h2>
    <h3 class="quiz-title">HAPPY NEW YEAR 2026</h3>
    <h4 class="quiz-title">General Knowledge Quiz Access</h4>

    <input type="password" id="quizPassword" placeholder="Enter Quiz Password">
    
    <button class="access-btn" onclick="checkPassword()">ENTER QUIZ</button>

    <p id="passMsg" class="error-msg"></p>
  </div>
</div>


<div class="container">
    <div id="studentPage">
        <div class="header">
            <span class="rainbow-school-name" id="secretTrigger">‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü, ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø</span>
            <h1 style="margin: 5px 0; font-size: 20px;"> ‡≤∏‡≤æ‡≤Æ‡≤æ‡≤®‡≥ç‡≤Ø ‡≤ú‡≥ç‡≤û‡≤æ‡≤®‡≤¶ ‡≤∞‡≤∏‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü ‡≤∏‡≥ç‡≤™‡≤∞‡≥ç‡≤ß‡≥Ü </h1>
            <div id="statusBanner" class="status-upcoming">‡≤≤‡≥ã‡≤°‡≥ç ‡≤Ü‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü...</div>
        </div>
        
        <div class="card">
        <label>‡≤§‡≤∞‡≤ó‡≤§‡≤ø (Class):</label>
            <select id="studentClass" onchange="handleClassChange()">
                <option value="">-- Select Class --</option>
                <option value="5">5‡≤®‡≥á ‡≤§‡≤∞‡≤ó‡≤§‡≤ø</option><option value="6">6‡≤®‡≥á ‡≤§‡≤∞‡≤ó‡≤§‡≤ø</option><option value="7">7‡≤®‡≥á ‡≤§‡≤∞‡≤ó‡≤§‡≤ø</option><option value="8">8‡≤®‡≥á ‡≤§‡≤∞‡≤ó‡≤§‡≤ø</option>
            </select>
            <label>‡≤µ‡≤ø‡≤¶‡≥ç‡≤Ø‡≤æ‡≤∞‡≥ç‡≤•‡≤ø‡≤Ø STS No. (Student STS number):</label>
            <input type="text"
 id="studentrollnumber"
 placeholder="Enter 9-Digit STS No."
 maxlength="9"
 inputmode="numeric"
 pattern="[0-9]{9}"
 disabled
 oninput="this.value=this.value.replace(/\D/g,''); fetchStudentFromMaster()">

            
            <label>‡≤µ‡≤ø‡≤¶‡≥ç‡≤Ø‡≤æ‡≤∞‡≥ç‡≤•‡≤ø‡≤Ø ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å (Student Name):</label>
            <input type="text" id="sName" placeholder="Student Name" readonly>
            <label>‡≤§‡≤Ç‡≤¶‡≥Ü‡≤Ø ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å (Father's Name):</label>
            <input type="text" id="pName" placeholder="Father Name" readonly>
            
            

            <button class="btn-main" id="startBtn" onclick="startQuiz()" disabled>‡≤ï‡≥ç‡≤µ‡≤ø‡≤ú‡≥ç ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø (Start Quiz) ‚ûî</button>
        </div>
    </div>

    <div id="quizPage" class="hidden">
        <div id="timer-sticky">‚è± <span id="timer">1500</span> ‡≤∏‡≥Ü‡≤ï‡≥Ü‡≤Ç‡≤°‡≥Å‡≤ó‡≤≥‡≥Å</div>
        <div id="questionsContainer"></div>
        <button class="btn-main" style="background:green; margin-bottom:50px;" onclick="submitQuiz()">‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø (Finish Quiz)</button>
    </div>
<!-- THANK YOU PAGE -->
<div id="thankYouPage" class="hidden">
  <div class="header">
    <div class="rainbow">‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü, ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø</div>
    <h2>üôè ‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶‡≤ó‡≤≥‡≥Å üôè</h2>
  </div>

  <div class="card" style="text-align:center">
    <h3 style="color:green">Quiz Submitted Successfully</h3>
    <p id="finalName"></p>
    <p style="color:red;font-weight:bold">‡≤ï‡≥á‡≤µ‡≤≤ ‡≤í‡≤Ç‡≤¶‡≥Å ‡≤™‡≥ç‡≤∞‡≤Ø‡≤§‡≥ç‡≤®‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü</p>

    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjTs7bWODsf6kahAsLK9E_U3a-hbACRye0_PQ1gQTejHbY72xVbW4LtZOub63G9Fx2ABvfY7MUONnkr9WJrG7NVMlqXwGEPgqqnbnf2x95iQFs2Ix0lJKvc2ggoJPshCxZqdTDPgfAPsEeTI9arQZPL1cmSl4vnG0v3e4eWocE3OMLesDxfjZ0HayaZLCID/s1600/220028.gif"
         width="280" height="130" loading="lazy">
  </div>
</div>

</div>
    <div id="scorePage" class="hidden">
        <div class="header"><span class="rainbow-school-name">‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü, ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø</span><h1>üìä Admin Panel</h1></div>
        <div class="card">
            <h3>üïí Competition Schedule</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div><label>Start:</label><input type="datetime-local" id="schedStart"></div>
                <div><label>End:</label><input type="datetime-local" id="schedEnd"></div>
            </div>
            <button onclick="saveSchedule()" class="btn-main">Update Schedule</button>
            <button onclick="resetSchedule()" style="background:#666; color:white;">Reset Schedule</button>
        </div>
        
        <div class="card">
  <h3>üì§ Bulk Upload Students (Excel)</h3>

  <input type="file" id="excelFile" accept=".xlsx,.xls">
  <button class="btn-main" onclick="uploadStudentsExcel()">Upload Students</button>

  <hr>

  <h4>‚ûï Add Single Student</h4>
  <input id="addClass" placeholder="Class (5-8)">
  <input id="addRoll" placeholder="9 Digit STS No">
  <input id="addName" placeholder="Student Name">
  <input id="addFather" placeholder="Father Name">

  <button class="btn-main" onclick="addSingleStudent()">Add Student</button>

  <hr>

  <button style="background:#e74c3c;color:white" onclick="wipeAllStudents()">
    üß® WIPE ALL STUDENTS
  </button>

  <p id="uploadStatus" style="font-weight:bold;"></p>
</div>

<div class="card">
  <h3>üìã Student Master List</h3>

  <button class="btn-main" onclick="toggleStudentList()">
    üëÅ Show / Hide Student List
  </button>

  <div id="studentListWrapper" class="hidden" style="margin-top:15px">
    <div style="overflow-x:auto">
      <table>
        <thead>
          <tr>
            <th>Class</th>
            <th>STS No</th>
            <th>Name</th>
            <th>Father</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="studentList"></tbody>
      </table>
    </div>
  </div>
</div>




        <div class="card">
            <h3>üîç Search & Filter</h3>
            <input type="text" id="adminSearch" placeholder="Search by Name or Roll No..." onkeyup="filterTable()"> </div>
        
        <div class="card">
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button onclick="downloadWholeResultsPDF()" style="background:#e74c3c; color:white; flex:1; font-size:12px;">PDF</button>
                <button onclick="exportCSV()" style="background:#1D6F42; color:white; flex:1; font-size:12px;">Excel</button>
                <button onclick="clearAllData()" style="background:#333; color:white; flex:1; font-size:12px;">Wipe All</button>
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead><tr><th>Rank</th><th>Student</th><th>Father</th><th>Class</th><th>Roll</th><th>Score</th><th>Action</th></tr></thead>
                    <tbody id="leaderboardBody"></tbody>
                </table>
            </div>
            <button onclick="location.reload()" style="background:#eee; color:#333; margin-top: 20px;">Exit Admin</button>
        </div>
    </div>

    <div id="adminModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; z-index:1000;">
        <div style="background:white; padding:30px; border-radius:15px; width:300px; text-align:center;">
            <h3>Admin Access</h3>
            <input type="password" id="adminPass" placeholder="Enter Password">
            <button class="btn-main" onclick="verifyAdmin()">Login</button>
            <button onclick="toggleAdminModal()" style="background:none; color:gray;">Close</button>
        </div>
    </div>
    <!-- EDIT STUDENT MODAL -->
<div id="editStudentModal" class="hidden"
style="position:fixed;inset:0;background:rgba(0,0,0,0.7);
display:flex;align-items:center;justify-content:center;z-index:2000">

  <div style="background:white;padding:25px;border-radius:15px;width:300px">
    <h3>Edit Student</h3>

    <input id="editClass" placeholder="Class">
    <input id="editRoll" placeholder="STS No" disabled>
    <input id="editName" placeholder="Student Name">
    <input id="editFather" placeholder="Father Name">

    <button class="btn-main" onclick="updateStudent()">Update</button>
    <button onclick="closeEditStudent()" style="background:#ccc">Cancel</button>
  </div>
</div>


<script>
let studentVerified = false;

// üîê QUIZ PASSWORD (CHANGE HERE)
const QUIZ_PASSWORD = "8151004545";

function checkPassword(){
  const pass = document.getElementById("quizPassword").value;
  if(pass === QUIZ_PASSWORD){
    document.getElementById("passwordScreen").style.display="none";
  }else{
    document.getElementById("passMsg").innerText="‚ùå Wrong Password";
  }
}

    // 1. FIREBASE CONFIG
    const firebaseConfig = {
        apiKey: "AIzaSyCDg2lvJAsZvqP1YfalJj6jpA7qTBn5qRM",
        authDomain: "mathsquizcompetitionsjs.firebaseapp.com",
        projectId: "mathsquizcompetitionsjs",
        storageBucket: "mathsquizcompetitionsjs.firebasestorage.app",
        messagingSenderId: "697659887210",
        appId: "1:697659887210:web:21d4f2a4244093466b0413"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    

       

    // 2. SECRET DOOR LOGIC
    let clicks = 0;
    let clickTimeout;
    document.getElementById('secretTrigger').onclick = function() {
        clicks++;
        clearTimeout(clickTimeout);
        if(clicks === 5) { clicks = 0; toggleAdminModal(); }
        clickTimeout = setTimeout(() => { clicks = 0; }, 2500);
    };

    function toggleAdminModal() { document.getElementById('adminModal').classList.toggle('hidden'); }

    function verifyAdmin() {
        if(document.getElementById('adminPass').value === "Sairam@123") {
            toggleAdminModal();
            document.getElementById('studentPage').classList.add('hidden');
            document.getElementById('scorePage').classList.remove('hidden');
            loadLeaderboard();
            loadScheduleInputs();

        } else { alert("Wrong Password!"); }
    }

    // 3. QUIZ CONTENT
    const questions = [
  // --- 5 SILENT WORDS (Silent Letters) ---
  { q: "Which letter is silent in the word 'Knee'?", options: ["N", "e", "K", "None"], a: "K" },
  { q: "Which letter is silent in the word 'Wrist'?", options: ["W", "r", "s", "t"], a: "W" },
  { q: "Which letter is silent in the word 'Listen'?", options: ["L", "s", "t", "e"], a: "t" },
  { q: "Which letter is silent in the word 'Comb'?", options: ["C", "o", "m", "b"], a: "b" },
  { q: "Which letter is silent in the word 'Honest'?", options: ["H", "o", "n", "s"], a: "H" },

  // --- 15 ENGLISH TO KANNADA MEANING ---
  { q: "What is the Kannada word for 'Water'?", options: ["‡≤ä‡≤ü ", "‡≤®‡≥Ä‡≤∞‡≥Å", "‡≤π‡≤æ‡≤≤‡≥Å", "‡≤π‡≤£‡≥ç‡≤£‡≥Å"], a: "‡≤®‡≥Ä‡≤∞‡≥Å" },
  { q: "What is the Kannada word for 'School'?", options: ["‡≤Æ‡≤®‡≥Ü", "‡≤∂‡≤æ‡≤≤‡≥Ü", "‡≤ä‡≤∞‡≥Å", "‡≤ï‡≥Ü‡≤≤‡≤∏"], a: "‡≤∂‡≤æ‡≤≤‡≥Ü" },
  { q: "What is the Kannada word for 'Friend'?", options: ["‡≤∏‡≥ç‡≤®‡≥á‡≤π‡≤ø‡≤§", "‡≤∂‡≤§‡≥ç‡≤∞‡≥Å", "‡≤ó‡≥Å‡≤∞‡≥Å", "‡≤∞‡≤æ‡≤ú"], a: "‡≤∏‡≥ç‡≤®‡≥á‡≤π‡≤ø‡≤§" },
  { q: "What is the Kannada word for 'Book'?", options: ["‡≤™‡≥Ü‡≤®‡≥ç‡≤®‡≥Å", "‡≤ö‡≥Ä‡≤≤", "‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï", "‡≤Æ‡≥á‡≤ú‡≥Å"], a: "‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï" },
  { q: "What is the Kannada word for 'Sun'?", options: ["‡≤ö‡≤Ç‡≤¶‡≥ç‡≤∞", "‡≤∏‡≥Ç‡≤∞‡≥ç‡≤Ø", "‡≤§‡≤æ‡≤∞‡≥Ü", "‡≤Ü‡≤ï‡≤æ‡≤∂"], a: "‡≤∏‡≥Ç‡≤∞‡≥ç‡≤Ø" },
  { q: "What is the Kannada word for 'Mother'?", options: ["‡≤§‡≤Ç‡≤¶‡≥Ü", "‡≤Ö‡≤Æ‡≥ç‡≤Æ", "‡≤Ö‡≤ï‡≥ç‡≤ï", "‡≤Ö‡≤£‡≥ç‡≤£"], a: "‡≤Ö‡≤Æ‡≥ç‡≤Æ" },
  { q: "What is the Kannada word for 'Flower'?", options: ["‡≤é‡≤≤‡≥Ü", "‡≤ó‡≤ø‡≤°", "‡≤π‡≥Ç‡≤µ‡≥Å", "‡≤¨‡≤≥‡≥ç‡≤≥‡≤ø"], a: "‡≤π‡≥Ç‡≤µ‡≥Å" },
  { q: "What is the Kannada word for 'Milk'?", options: ["‡≤Æ‡≥ä‡≤∏‡≤∞‡≥Å", "‡≤§‡≥Å‡≤™‡≥ç‡≤™", "‡≤®‡≥Ä‡≤∞‡≥Å", "‡≤π‡≤æ‡≤≤‡≥Å"], a: "‡≤π‡≤æ‡≤≤‡≥Å" },
  { q: "What is the Kannada word for 'Eye'?", options: ["‡≤ï‡≤ø‡≤µ‡≤ø", "‡≤Æ‡≥Ç‡≤ó‡≥Å", "‡≤ï‡≤£‡≥ç‡≤£‡≥Å", "‡≤¨‡≤æ‡≤Ø‡≤ø"], a: "‡≤ï‡≤£‡≥ç‡≤£‡≥Å" },
  { q: "What is the Kannada word for 'Tree'?", options: ["‡≤ó‡≤ø‡≤°", "‡≤Æ‡≤∞", "‡≤π‡≤£‡≥ç‡≤£‡≥Å", "‡≤ï‡≤æ‡≤°‡≥Å"], a: "‡≤Æ‡≤∞" },{ q: "What is the Kannada word for 'To Eat'?", options: ["‡≤ì‡≤¶‡≥Å", "‡≤§‡≤ø‡≤®‡≥ç‡≤®‡≥Å", "‡≤®‡≤ó‡≥Å", "‡≤Æ‡≤≤‡≤ó‡≥Å"], a: "‡≤§‡≤ø‡≤®‡≥ç‡≤®‡≥Å" },
  { q: "What is the Kannada word for 'Sleep'?", options: ["‡≤®‡≤°‡≥Ü‡≤Ø‡≥Å", "‡≤ì‡≤°‡≥Å", "‡≤Æ‡≤≤‡≤ó‡≥Å", "‡≤π‡≤æ‡≤°‡≥Å"], a: "‡≤Æ‡≤≤‡≤ó‡≥Å" },
  { q: "What is the Kannada word for 'Play'?", options: ["‡≤Ü‡≤°‡≥Å", "‡≤¨‡≤∞‡≥Ü", "‡≤ï‡≥á‡≤≥‡≥Å", "‡≤®‡≥ã‡≤°‡≥Å"], a: "‡≤Ü‡≤°‡≥Å" },
  { q: "What is the Kannada word for 'Come'?", options: ["‡≤π‡≥ã‡≤ó‡≥Å", "‡≤¨‡≤æ", "‡≤ï‡≥Å‡≤≥‡≤ø‡≤§‡≥Å‡≤ï‡≥ä", "‡≤®‡≤ø‡≤≤‡≥ç‡≤≤‡≥Å"], a: "‡≤¨‡≤æ" },
  { q: "What is the Kannada word for 'Read'?", options: ["‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≥Å", "‡≤ï‡≥á‡≤≥‡≥Å", "‡≤ì‡≤¶‡≥Å", "‡≤π‡≤æ‡≤°‡≥Å"], a: "‡≤ì‡≤¶‡≥Å" },

  // --- 5 OPPOSITE WORDS ---
  { q: "What is the opposite of 'Difficult'?", options: ["Hard", "Easy", "Simple", "Soft"], a: "Easy" },
  { q: "What is the opposite of 'Good'?", options: ["Strong", "Bad", "Hero", "Bold"], a: "Bad" },
  { q: "What is the opposite of 'Up'?", options: ["Thin", "Small", "Down", "Long"], a: "Down" },
  { q: "What is the opposite of 'Day'?", options: ["Reach", "Stay", "Night", "Come"], a: "Night" },
  { q: "What is the opposite of 'old'?", options: ["Best", "New", "Sweet", "Clean"], a: "New" },

  // --- 5 FIND ODD ONE OUT ---
  { q: "Find the odd one out:", options: ["Tiger", "Lion", "Leopard", "Cow"], a: "Cow" },
  { q: "Find the odd one out:", options: ["Circle", "Square", "Blue", "Triangle"], a: "Blue" },
  { q: "Find the odd one out:", options: ["Doctor", "Nurse", "Patient", "Teacher"], a: "Teacher" },
  { q: "Find the odd one out:", options: ["Monday", "January", "March", "June"], a: "Monday" },
  { q: "Find the odd one out:", options: ["Apple", "Carrot", "Mango", "Banana"], a: "Carrot" },

  // --- 5 CORRECT SPELLING ---
  { q: "Which of these is the correct spelling?", options: ["Beleive", "Believe", "Belive", "Beleeve"], a: "Believe" },
  { q: "Which of these is the correct spelling?", options: ["Tommorow", "Tomorrow", "Tomoro", "To-morrow"], a: "Tomorrow" },
  { q: "Which of these is the correct spelling?", options: ["Beautiful", "Beatiful", "Beatiful", "Butiful"], a: "Beautiful" },
  { q: "Which of these is the correct spelling?", options: ["Next", "Nixt", "Nest", "Neeset"], a: "Next" },
  { q: "Which of these is the correct spelling?", options: ["Febuary", "Feburary", "February", "Februery"], a: "February" },

  // --- 5 PLURAL WORDS ---
  { q: "What is the plural of 'Knife'?", options: ["Knifes", "Knive", "Knives", "Knifey"], a: "Knives" },
  { q: "What is the plural of 'Potato'?", options: ["Potatos", "Potatoes", "Potatose", "Potatoe"], a: "Potatoes" },
  { q: "What is the plural of 'Foot'?", options: ["Foots", "Feets", "Feet", "Footes"], a: "Feet" },
  { q: "What is the plural of 'Box'?", options: ["Boxs", "Boxes", "Boxen", "Boxies"], a: "Boxes" },
  { q: "What is the plural of 'Fish'?", options: ["Fishes", "Fish", "Fishs", "Both"], a: "Both" },

  // --- 5 AFTER & BEFORE ---
  { q: "Which letter comes before 'M' in the alphabet?", options: ["L", "N", "K", "O"], a: "L" },
  { q: "Which number comes after 99?", options: ["98", "100", "101", "90"], a: "100" },
  { q: "Which day comes before Wednesday?", options: ["Tuesday", "Thursday", "Monday", "Friday"], a: "Tuesday" },
  { q: "Which month comes after August?", options: ["July", "September", "October", "November"], a: "September" },
  { q: "Which letter comes before 'X'?", options: ["Y", "W", "V", "Z"], a: "W" },

  // --- 5 COMPLETE THE WORD (Filling in the Gaps) ---
  { q: "Complete the word: B _ _ T H D A Y", options: ["I, R", "E, R", "U, R", "O, R"], a: "I, R" },
  { q: "Complete the word: C _ _ C K E N", options: ["H, I", "H, E", "K, I", "S, I"], a: "H, I" },
  { q: "Complete the word: S _ H _ _ L", options: ["C, O, O", "K, O, O", "H, O, O", "C, U, U"], a: "C, O, O" },
  { q: "Complete the word: M _ _ N T A I N", options: ["O, U", "A, U", "O, A", "U, U"], a: "O, U" },
  { q: "Complete the word: V _ G _ T A B L E", options: ["E, E", "A, E", "I, E", "E, I"], a: "E, E" }
];


let quizSubmitted = false;
let quizTimerRef = null;

    // 4. MAIN FUNCTIONS
    async function updateStatus() {
        const doc = await db.collection("settings").doc("quizTime").get();
        const banner = document.getElementById('statusBanner');
        const startBtn = document.getElementById('startBtn');
        if(!doc.exists || !doc.data().start) {
            banner.className="status-upcoming"; banner.innerText = "‡≤¶‡≤ø‡≤®‡≤æ‡≤Ç‡≤ï 22-01-2026 ‡≤∞‡≤Ç‡≤¶‡≥Å ‡≤∏‡≤æ‡≤Æ‡≤æ‡≤®‡≥ç‡≤Ø ‡≤ú‡≥ç‡≤û‡≤æ‡≤®‡≤¶ ‡≤∞‡≤∏‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü ‡≤∏‡≥ç‡≤™‡≤∞‡≥ç‡≤ß‡≥Ü ‡≤®‡≤°‡≥Ü‡≤∏‡≤≤‡≤æ‡≤ó‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å.";
            startBtn.disabled = true; return;
        }
        const now = new Date(), start = new Date(doc.data().start), end = new Date(doc.data().end);
        if(now < start) { banner.className="status-upcoming"; banner.innerText = "Upcoming..."; startBtn.disabled = true; }
        else if(now <= end) { banner.className = "status-live"; banner.innerText = "‚óè LIVE: Quiz is Open!"; startBtn.disabled = !studentVerified;

 }
        else { banner.className = "status-closed"; banner.innerText = "Closed!"; startBtn.disabled = true; }
    }
    setInterval(updateStatus, 5000); updateStatus();

    
async function startQuiz() {

    if (!studentVerified) {
        alert("‚õî Invalid STS Number. Quiz access denied.");
        return;
    }

    // üîí FINAL SCHEDULE CHECK
    const schedDoc = await db.collection("settings").doc("quizTime").get();

    if (!schedDoc.exists) {
        alert("‚õî ‡≤ï‡≥ç‡≤µ‡≤ø‡≤ú‡≥ç ‡≤á‡≤®‡≥ç‡≤®‡≥Ç ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤µ‡≤æ‡≤ó‡≤ø‡≤≤‡≥ç‡≤≤!");
        return;
    }

    const now = new Date();
    const start = new Date(schedDoc.data().start);
    const end = new Date(schedDoc.data().end);

    if (now < start || now > end) {
        alert("‚è∞ Quiz is CLOSED or NOT YET STARTED.");
        return;
    }

    const cls = document.getElementById('studentClass').value;
    const roll = document.getElementById('studentrollnumber').value.trim();
    const name = document.getElementById('sName').value.trim();

    if (!cls || roll.length !== 9 || !name) {
        alert("Student verification incomplete");
        return;
    }

    // ‚úÖ LOAD QUESTIONS
    document.getElementById('questionsContainer').innerHTML =
        questions.map((item, i) => `
        <div class="card question-box">
            <b class="question-text">${i + 1}. ${item.q}</b>
            <div class="options-grid">
                ${item.options.map(opt => `
                    <label class="option-card">
                        <input type="radio" name="q${i}" value="${opt}"> ${opt}
                    </label>
                `).join('')}
            </div>
        </div>
    `).join('');

    document.getElementById('studentPage').classList.add('hidden');
    document.getElementById('quizPage').classList.remove('hidden');

    let timer = 1500;
    quizTimerRef = setInterval(() => {
        timer--;
        document.getElementById('timer').innerText = timer;
        if (timer <= 0) {
            clearInterval(quizTimerRef);
            submitQuiz();
        }
    }, 1000);
}


    
    // 5. ADMIN UTILITIES
    async function loadLeaderboard() {
        const snap = await db.collection("mathResults").orderBy("score", "desc").get();
        let rank = 1;
        document.getElementById('leaderboardBody').innerHTML = snap.docs.map(doc => {
            const d = doc.data();
            return `<tr>
                <td>#${rank++}</td>
                <td>${d.name}</td>
                <td>${d.father}</td>
                <td>${d.class}</td>
                <td>${d.roll}</td>
                <td>${d.score}/50</td>
                <td>
                    <button onclick="generateCert('${d.name}', '${d.score}', '${d.class}')" style="background:orange; padding:4px; font-size:10px;">Cert</button>
                    <button onclick="deleteRecord('${doc.id}')" style="background:red; padding:4px; font-size:10px;">Del</button>
                </td>
            </tr>`;
        }).join('');
    }

    function filterTable() {
        let val = document.getElementById('adminSearch').value.toUpperCase();
        document.querySelectorAll("#leaderboardBody tr").forEach(tr => {
            tr.style.display = tr.innerText.toUpperCase().includes(val) ? "" : "none";
        });
    }

    function exportCSV() {
        let csv = "Rank,Name,Father,Class,Roll,Score\n";
        document.querySelectorAll("#leaderboardBody tr").forEach(tr => {
            const c = tr.querySelectorAll("td");
            csv += `"${c[0].innerText}","${c[1].innerText}","${c[2].innerText}","${c[3].innerText}","${c[4].innerText}","${c[5].innerText}"\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'Quiz_Results.csv';
        a.click();
    }

    function generateCert(name, score, cls) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: "landscape" });
        doc.rect(10, 10, 277, 190);
        doc.setFontSize(30); doc.text("‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü, ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø ‡≤§‡≤æ; ‡≤¨‡≤∏‡≤µ‡≤ï‡≤≤‡≥ç‡≤Ø‡≤æ‡≤£ ‡≤ú‡≤ø : ‡≤¨‡≥Ä‡≤¶‡≤∞", 148, 40, {align:"center"});
        doc.setFontSize(20); doc.text("CERTIFICATE OF GK QUIZ MERIT", 148, 60, {align:"center"});
        doc.setFontSize(16); doc.text(`This is to certify that ${name} of Class ${cls}`, 148, 100, {align:"center"});
        doc.text(`scored ${score} out of 50 in General Knowledge Quiz 2026`, 148, 120, {align:"center"});
        doc.save(`${name}_Cert.pdf`);
    }
    
 
    
    

    async function deleteRecord(id) {
        if(confirm("Delete this student record?")) {
            await db.collection("mathResults").doc(id).delete();
            loadLeaderboard();
        }
    }

    async function saveSchedule() {
        const start = document.getElementById('schedStart').value;
        const end = document.getElementById('schedEnd').value;
        if(!start || !end) return alert("Set both times!");
        await db.collection("settings").doc("quizTime").set({ start, end });
        alert("Schedule Saved!"); updateStatus();
    }

    async function resetSchedule() {
        if(confirm("Reset schedule? This will lock the quiz for students.")) {
            await db.collection("settings").doc("quizTime").delete();
            document.getElementById('schedStart').value = "";
            document.getElementById('schedEnd').value = "";
            alert("Schedule Reset!"); updateStatus();
        }
    }

    async function clearAllData() {
        if(confirm("WARNING: Delete ALL results?")) {
            const snap = await db.collection("mathResults").get();
            const batch = db.batch();
            snap.docs.forEach(doc => batch.delete(doc.ref));
            await batch.commit();
            alert("All results wiped!"); loadLeaderboard();
        }
    }

    
    async function loadScheduleInputs() {
        const doc = await db.collection("settings").doc("quizTime").get();
        if(doc.exists) {
            document.getElementById('schedStart').value = doc.data().start;
            document.getElementById('schedEnd').value = doc.data().end;
        }
    }

    async function downloadWholeResultsPDF() {
        const { jsPDF } = window.jspdf; const doc = new jsPDF();
        const snap = await db.collection("mathResults").orderBy("score", "desc").get();
        const rows = snap.docs.map((d, i) => [i+1, d.data().name, d.data().father, d.data().class, d.data().roll, d.data().score + "/50"]);
        doc.text("Govt. Higher Primary School Dasarawadi, GK Quiz Results 2026", 14, 15);
        doc.autoTable({ head: [['Rank', 'Name','Father', 'Class', 'STS No.', 'Score']], body: rows, startY: 20 });
        doc.save("Quiz Results.pdf");
    }
    async function submitQuiz() {

    if (quizSubmitted) return; // prevent double submit
    quizSubmitted = true;

    clearInterval(quizTimerRef);

    const name = document.getElementById('sName').value.trim();
    const father = document.getElementById('pName').value.trim();
    const cls = document.getElementById('studentClass').value;
    const roll = document.getElementById('studentrollnumber').value.trim();

    let score = 0;

    questions.forEach((q, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (selected && selected.value === q.a) {
            score++;
        }
    });

    // üîí Save result to Firebase
    const resultId = `${cls}_${roll}`;
await db.collection("mathResults").doc(resultId).set({
        name: name,
        father: father,
        class: cls,
        roll: roll,
        score: score,
        submittedAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    // ‚úÖ SHOW THANK YOU PAGE
    document.getElementById('quizPage').classList.add('hidden');
    document.getElementById('thankYouPage').classList.remove('hidden');
    document.getElementById('finalName').innerText =
        `Student: ${name}`;
}
async function uploadStudentsExcel() {

    const fileInput = document.getElementById("excelFile");
    const status = document.getElementById("uploadStatus");

    if (!fileInput.files.length) {
        alert("Please select Excel file");
        return;
    }

    status.innerText = "‚è≥ Reading Excel file...";

    const reader = new FileReader();
    reader.onload = async function (e) {

        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];

        const rows = XLSX.utils.sheet_to_json(sheet);

        if (!rows.length) {
            status.innerText = "‚ùå Excel file is empty";
            return;
        }

        let uploaded = 0;
        let skipped = 0;

       for (let row of rows) {

    const cls = String(row.class || "").trim();
    const roll = String(row.roll || "").trim();
    const name = String(row.name || "").trim().toUpperCase();
    const father = String(row.father || "").trim().toUpperCase();

    if (!cls || roll.length !== 9 || !name || !father) {
        skipped++;
        continue;
    }

    const docId = `${cls}_${roll}`;
    const docRef = db.collection("students").doc(docId);
    const docSnap = await docRef.get();

    if (docSnap.exists) {
        skipped++;
        continue;
    }

    await docRef.set({
        class: cls,
        roll: roll,
        name: name,
        father: father
    });

    uploaded++;
}


        status.innerText =
            `‚úÖ Upload Complete | Added: ${uploaded} | Skipped: ${skipped}`;
    };

    reader.readAsArrayBuffer(fileInput.files[0]);
}

async function fetchStudentFromMaster() {

    const cls = document.getElementById("studentClass").value;
    const roll = document.getElementById("studentrollnumber").value.trim();
    const nameInput = document.getElementById("sName");
    const fatherInput = document.getElementById("pName");
    const startBtn = document.getElementById("startBtn");

    // RESET
    studentVerified = false;
    startBtn.disabled = true;

    if (!cls || roll.length !== 9) {
        nameInput.value = "";
        fatherInput.value = "";
        return;
    }

    nameInput.value = "Verifying...";

    try {
        const docId = `${cls}_${roll}`;

        // üîç CHECK MASTER STUDENT LIST
        const studentDoc = await db.collection("students").doc(docId).get();

        if (!studentDoc.exists) {
            nameInput.value = "‚ùå NOT FOUND";
            fatherInput.value = "Invalid STS Number";
            studentVerified = false;
            return;
        }

        // üîí CHECK IF ALREADY ATTEMPTED
        const resultDoc = await db.collection("mathResults").doc(docId).get();

        if (resultDoc.exists) {
            nameInput.value = "‚ùå ALREADY SUBMITTED";
            fatherInput.value = "Only one attempt allowed";
            studentVerified = false;
            alert("‚ö†Ô∏è You have already submitted this quiz.");
            return;
        }

        // ‚úÖ VALID STUDENT
        const data = studentDoc.data();
        nameInput.value = data.name;
        fatherInput.value = data.father;

        studentVerified = true;
        startBtn.disabled = false;

    } catch (err) {
        console.error(err);
        nameInput.value = "ERROR";
        fatherInput.value = "Try again";
        studentVerified = false;
    }
}


function handleClassChange() {
    const rollInput = document.getElementById("studentrollnumber");
    const cls = document.getElementById("studentClass").value;
    
    if (cls) {
        rollInput.disabled = false;
        rollInput.value = ""; // Clear previous roll to force re-verification
        document.getElementById("sName").value = "";
        document.getElementById("pName").value = "";
    } else {
        rollInput.disabled = true;
    }
}
// üìã LOAD STUDENT MASTER LIST
async function loadStudentsList() {
  const snap = await db.collection("students").orderBy("class").get();
  document.getElementById("studentList").innerHTML = snap.docs.map(d => {
    const s = d.data();
    return `
      <tr>
        <td>${s.class}</td>
        <td>${s.roll}</td>
        <td>${s.name}</td>
        <td>${s.father}</td>
        <td>
          <button style="background:orange;font-size:12px"
            onclick="openEditStudent('${d.id}','${s.class}','${s.roll}','${s.name}','${s.father}')">
            Edit
          </button>
          <button style="background:red;color:white;font-size:12px"
            onclick="deleteStudent('${d.id}')">
            Delete
          </button>
        </td>
      </tr>`;
  }).join("");
}


// ‚ùå DELETE SINGLE STUDENT
async function deleteStudent(id) {
  if (!confirm("Delete this student?")) return;
  await db.collection("students").doc(id).delete();
  loadStudentsList();
}

// ‚ûï ADD SINGLE STUDENT
async function addSingleStudent() {
  const cls = document.getElementById("addClass").value.trim();
  const roll = document.getElementById("addRoll").value.trim();
  const name = document.getElementById("addName").value.trim().toUpperCase();
  const father = document.getElementById("addFather").value.trim().toUpperCase();

  if (!cls || roll.length !== 9 || !name || !father) {
    alert("Fill all fields correctly");
    return;
  }

  const id = `${cls}_${roll}`;
  const ref = db.collection("students").doc(id);
  const snap = await ref.get();

  if (snap.exists) {
    alert("Student already exists");
    return;
  }

  await ref.set({ class: cls, roll, name, father });
  alert("Student Added");

  document.getElementById("addClass").value = "";
  document.getElementById("addRoll").value = "";
  document.getElementById("addName").value = "";
  document.getElementById("addFather").value = "";

  loadStudentsList();
}

// üß® WIPE ALL STUDENTS
async function wipeAllStudents() {
  if (!confirm("‚ö†Ô∏è This will DELETE ALL STUDENTS. Continue?")) return;

  const snap = await db.collection("students").get();
  const batch = db.batch();
  snap.docs.forEach(doc => batch.delete(doc.ref));
  await batch.commit();

  alert("All students deleted");
  loadStudentsList();
}
let editStudentId = "";

// ‚úèÔ∏è OPEN EDIT MODAL
function openEditStudent(id, cls, roll, name, father) {
  editStudentId = id;
  document.getElementById("editClass").value = cls;
  document.getElementById("editRoll").value = roll;
  document.getElementById("editName").value = name;
  document.getElementById("editFather").value = father;
  document.getElementById("editStudentModal").classList.remove("hidden");
}

// ‚ùå CLOSE MODAL
function closeEditStudent() {
  document.getElementById("editStudentModal").classList.add("hidden");
}

// üíæ UPDATE STUDENT
async function updateStudent() {
  const cls = document.getElementById("editClass").value.trim();
  const name = document.getElementById("editName").value.trim().toUpperCase();
  const father = document.getElementById("editFather").value.trim().toUpperCase();

  if (!cls || !name || !father) {
    alert("Fill all fields");
    return;
  }

  await db.collection("students").doc(editStudentId).update({
    class: cls,
    name: name,
    father: father
  });

  alert("Student Updated");
  closeEditStudent();
  loadStudentsList();
}
function toggleStudentList() {
  const box = document.getElementById("studentListWrapper");

  if (box.classList.contains("hidden")) {
    box.classList.remove("hidden");
    loadStudentsList(); // load only when opened
  } else {
    box.classList.add("hidden");
  }
}
 document.addEventListener("contextmenu", function (e) {
    e.preventDefault();

    alert("‚ö†Ô∏è Right-click is disabledüôè");
  });

</script>
</body>
</html>






